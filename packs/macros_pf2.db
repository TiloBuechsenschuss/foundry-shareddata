{"name":"Light Picker","type":"script","author":"u0QnuKi1BChalBsY","img":"icons/sundries/lights/lantern-iron-yellow.webp","scope":"global","command":"function tokenUpdate(data) {\n  canvas.tokens.controlled.map(token => token.document.update({ light: data }));\n}\n\nlet torchAnimation = { \"type\": \"torch\", \"speed\": 1, \"intensity\": 1, \"reverse\": false };\n\nlet dialogEditor = new Dialog({\n  title: `Token Light Picker`,\n  content: `Pick the light source the selected token is holding.`,\n  buttons: {\n    none: {\n      label: `None`,\n      callback: () => {\n        tokenUpdate({ \"dim\": 0, \"bright\": 0, \"angle\": 360, \"luminosity\": 0.5 });\n        dialogEditor.render(true);\n      }\n    },\n    torchlight: {\n      label: `Torch / Light cantrip`,\n      callback: () => {\n        tokenUpdate({ \"dim\": 40, \"bright\": 20, \"angle\": 360, \"luminosity\": 0.5, \"animation\": { \"type\": \"none\" } });\n        dialogEditor.render(true);\n      }\n    },\n    ligth4th: {\n      label: `Light cantrip >= 4th level`,\n      callback: () => {\n        tokenUpdate({ \"dim\": 120, \"bright\": 60, \"angle\": 360, \"luminosity\": 0.5, \"animation\": { \"type\": \"none\" } });\n        dialogEditor.render(true);\n      }\n    },    \n    bullseye: {\n      label: `Bullseye Lantern`,\n      callback: () => {\n        tokenUpdate({ \"dim\": 120, \"bright\": 60, \"angle\": 45, \"luminosity\": 0.5, \"animation\": torchAnimation });\n        dialogEditor.render(true);\n      }\n    },\n    hoodedOpen: {\n      label: `Hooded Lantern (Open)`,\n      callback: () => {\n        tokenUpdate({ \"dim\": 60, \"bright\": 30, \"angle\": 360, \"luminosity\": 0.5, \"animation\": torchAnimation });\n        dialogEditor.render(true);\n      }\n    },    \n    darkness: {\n      label: `Darkness spell`,\n      callback: () => {\n        tokenUpdate({ \"dim\": 0, \"bright\": 20, \"angle\": 360, \"luminosity\": -0.5, \"animation\": { \"type\": \"none\" } });\n        dialogEditor.render(true);\n      }\n    },\n    close: {\n      icon: \"<i class='fas fa-tick'></i>\",\n      label: `Close`\n    },\n  },\n  default: \"close\",\n  close: () => { }\n});\n\ndialogEditor.render(true)","folder":null,"sort":0,"permission":{"default":2,"u0QnuKi1BChalBsY":3},"flags":{"combat-utility-belt":{"macroTrigger":""},"core":{"sourceId":"Macro.o2dQLM20cd9Ivm9Q"},"advanced-macros":{"runAsGM":false},"scene-packer":{"sourceId":"Macro.o2dQLM20cd9Ivm9Q","defaultPermission":2,"hash":"62a7cc621bbe84c296ebc4f010a19e04a1e37d64"}},"_id":"E4gL8M8uD2kBMV9t"}
{"name":"Reset Hero Points to 1","permission":{"default":0,"u0QnuKi1BChalBsY":3},"type":"script","flags":{"combat-utility-belt":{"macroTrigger":""},"furnace":{"runAsGM":false},"core":{"sourceId":"Macro.eb8MutMjaYCKkCwj"}},"scope":"global","command":"/* =======================================\n## Instructions\n# Reset hero points\nAll players will have their hero points set to one.\nsource: https://github.com/brunocalado/mestre-digital/tree/master/Foundry%20VTT/Macros/Pathfinder%202\n*/\n\nresetHeroPoints();\n\nfunction resetHeroPoints() {\n  let characters = game.actors.entities.filter((t) => t.data.type === \"character\");\n  characters.forEach( (c) => {\n    c.update({['data.attributes.heroPoints.rank']: 1});  \n  }); \n}","author":"u0QnuKi1BChalBsY","img":"icons/svg/thrust.svg","actorIds":[],"_id":"byeVUSXHZTeYmaOR"}
{"name":"Hero Point Manager","permission":{"default":0,"u0QnuKi1BChalBsY":3},"type":"script","flags":{"combat-utility-belt":{"macroTrigger":""},"furnace":{"runAsGM":true},"core":{"sourceId":"Macro.2GfyaSEUFhCJpLes"}},"scope":"global","command":"/* =======================================\n## Instructions\n# Give one player hero points.\nYou can select the token player or choose him from the combobox. \nChoose the amount of hero points and click Apply. \n# Reset hero points\nIf you check this box, all players will have their hero points set to one.\nsource: https://github.com/brunocalado/mestre-digital/tree/master/Foundry%20VTT/Macros/Pathfinder%202\n*/\n\ngetRequirements();\n\nfunction getRequirements() {\n  let playersNames = game.actors.entities.filter((t) => t.data.type === \"character\").map((p=> p.data.name)); \n  let playerNameList = '';\n  let currentHeroPointsList = '';\n  let playerSelected;\n  if (actor) {   /* get selected token */\n    playerSelected = canvas.tokens.controlled[0].actor.name;    \n  }    \n  playersNames.map((el) => {      \n    if (el===playerSelected) {\n      playerNameList += `<option value=\"${el}\" selected>${el}</option>`;\n    } else {\n      playerNameList += `<option value=\"${el}\">${el}</option>`;      \n    }    \n  });\n  \n  /* Show actual hero points*/\n  let currentHeroPoints = checkHeroPoints();\n  for (let i = 0; i < currentHeroPoints.length; i++) {\n    currentHeroPointsList += '<li>' + currentHeroPoints[i][0] + ': ' + currentHeroPoints[i][1] + '</li>';\n    console.log('<li>' + currentHeroPoints[i][0] + ': ' + currentHeroPoints[i][1] + '</li>');\n  }  \n  \n  let template = `\n  <p>Player: <select id=\"playerName\">${playerNameList}</select></p>\n  <p>\n    How much points do you want to give? <input id=\"heroPoints\" type=\"number\" min=\"1\" max=\"3\" style=\"width: 50px;\" value=1>\n  </p>  \n  <br />\n  <h3>Current Hero Points</h3>\n  <ul>\n    ${currentHeroPointsList}\n  </ul>\n  <br />\n  <p>\n    <input type=\"checkbox\" id=\"reset\"/>Reset Hero Points? (this will set each character to 1 hero point)\n  </p> \n  `;\n  new Dialog({\n    title: \"Hero Points\",\n    content: template,\n    buttons: {\n      ok: {\n        label: \"Apply\",\n        callback: (html) => {\n          main(html);\n        },\n      },\n      cancel: {\n        label: \"Cancel\",\n      },\n    },\n  }).render(true);\n}\n\nfunction main(html){\n  let playerName = html.find(\"#playerName\")[0].value;\n  let heroPoints = html.find(\"#heroPoints\")[0].value;  \n  const resetHeroPointsFlag = html.find(\"#reset\")[0].checked;  \n  \n  if (resetHeroPointsFlag) {    \n    resetHeroPoints();\n  } else {\n    updateHeroPoints(playerName, heroPoints);\n  }\n}\n\nfunction updateHeroPoints(playerName, heroPoints) {\n  let character = game.actors.entities.filter((t) => t.data.type === \"character\").filter((v) => v.data.name === playerName)[0];\n  let currentHeroPoints = parseInt( character.data.data.attributes.heroPoints.rank, 10);\n  let total = currentHeroPoints + parseInt( heroPoints, 10);\n  console.log('Adding ' + heroPoints + ' to ' + playerName + '. Total: ' + total);\n  if (total>3) { // check sum\n    ui.notifications.warn(`Player [${playerName}] has ${currentHeroPoints}. Maximum allowed is 3.`, {});   \n  } else {    \n    character.update({['data.attributes.heroPoints.rank']: total});  \n  }\n}\n\nfunction resetHeroPoints() {\n  let characters = game.actors.entities.filter((t) => t.data.type === \"character\");\n  characters.forEach( (c) => {\n    //console.log(c.data.data.attributes.heroPoints.rank);\n    c.update({['data.attributes.heroPoints.rank']: 1});  \n  }); \n}\n\nfunction checkHeroPoints() {\n  let heros = [];\n  let characters = game.actors.entities.filter((t) => t.data.type === \"character\");\n  characters.forEach( (c) => {\n    //console.log(c.data.name + '/ ' + c.data.data.attributes.heroPoints.rank);    \n    heros.push([c.data.name, c.data.data.attributes.heroPoints.rank]);\n  }); \n  return heros;\n}","author":"u0QnuKi1BChalBsY","img":"icons/svg/dice-target.svg","actorIds":[],"_id":"oQhkVLND05VHG32Z"}
{"name":"EXP Manager","type":"script","author":"u0QnuKi1BChalBsY","img":"images/Icons/EXP%20Manager.svg","scope":"global","command":"const macroVersion = 'v0.4.5';\n/* EXP Manager PF2\n## Features\n- Select a token and it'll be selected in the combo\n- Choose the amount of experience to give or to remove.\n- Send XP for everyone\n- Warn about level available\nsource: https://raw.githubusercontent.com/brunocalado/mestre-digital/master/Foundry%20VTT/Macros/Pathfinder%202/EXP%20Manager.js\nicon: https://raw.githubusercontent.com/brunocalado/mestre-digital/master/Foundry%20VTT/Macros/Pathfinder%202/EXP%20Manager.svg\n\npatched by Alarion Irisar\n*/\n\nvar excludeNames = [\n    '(Compendium Roll)',\n    'Krohan',\n    'Zartu Thornscale Pre-Rebuild',\n    'z_Test',\n    'z_Light',\n    'z_Shared Vision'\n];\n\nmain();\n\nfunction main() {\n    let playersNames = getNameList();\n    let playerNameList;\n    let currentExperienceList = '';\n    let playerSelected;\n    if (actor) {   /* get selected token */\n        playerSelected = canvas.tokens.controlled[0].actor.name;\n        playerNameList = `<option value=\"everyone\">Everyone</option>`;\n    } else {\n        playerNameList = `<option value=\"everyone\" selected>Everyone</option>`;\n    }\n    playersNames.map((el) => {\n        if (el === playerSelected) {\n            playerNameList += `<option value=\"${el}\" selected>${el}</option>`;\n        } else {\n            playerNameList += `<option value=\"${el}\">${el}</option>`;\n        }\n    });\n\n    /* Show actual xp points*/\n    //     heros.push([c.data.name, c.data.data.details.xp.value, 1000]);\n\n    let currentExperiencePoints = checkHeroExp();\n    for (let i = 0; i < currentExperiencePoints.length; i++) {\n        let levelAvailable = '';\n        if (parseInt(currentExperiencePoints[i][1]) >= 1000) {\n            levelAvailable = ' <b style=\"color:red\">(level available)</b>';\n        }\n        currentExperienceList += '<li>' + currentExperiencePoints[i][0] + ' - LV:' + currentExperiencePoints[i][2] + ' - XP:' + currentExperiencePoints[i][1] + levelAvailable + '</li>';\n    }\n\n    let template = `\n  <h2>Choose</h2>\n  <p><b>Hero:</b> <select id=\"playerName\" style=\"width: 200px\">${playerNameList}</select></p>\n  <p>\n    <b>How much points do you want to give?</b> <input id=\"experiencePoints\" type=\"number\" min=\"-1000\" max=\"1000\" step=\"10\" style=\"width: 80px; box-sizing: border-box;border: none;background-color: #2d3748;color: white; text-align: center; \" value=1>\n  </p>    \n  <h2>Current Experience Points</h2>\n  <ul>\n    ${currentExperienceList}\n  </ul>\n  `;\n\n    new Dialog({\n        title: `Experience Manager - ${macroVersion}`,\n        content: template,\n        buttons: {\n            ok: {\n                label: \"Apply\",\n                callback: async (html) => {\n                    expmanager(html);\n                },\n            },\n            cancel: {\n                label: \"Cancel\",\n            },\n        },\n    }).render(true);\n}\n\nfunction getNameList() {\n    let playersNames = game.actors.filter((t) => t.data.type === \"character\").map((p => p.data.name));\n\n    var sanitized = [];\n\n    playersNames.map((el) => {\n        let addName = true;\n\n        if (el.substring(0, 2) == \"z_\") { addName = false; }\n        if (excludeNames.includes(el)) { addName = false; }\n\n        if (addName) {\n            sanitized.push(el);\n        }\n    });\n\n    return sanitized;\n}\n\nasync function expmanager(html) {\n    let playerName = html.find(\"#playerName\")[0].value;\n    let experiencePoints = html.find(\"#experiencePoints\")[0].value;\n    if (playerName == 'everyone') {\n        updateAllHerosXP(experiencePoints);\n    } else {\n        updateOneHeroXP(playerName, experiencePoints);\n    }\n}\n\nasync function updateOneHeroXP(playerName, experiencePoints) {\n    let character = game.actors.filter((t) => t.data.type === \"character\").filter((v) => v.data.name === playerName)[0];\n    let currentExperiencePoints = parseInt(character.data.data.details.xp.value);\n    let total = currentExperiencePoints + parseInt(experiencePoints);\n    await character.update({ ['data.details.xp.value']: total });\n    expMessage(character, experiencePoints);\n}\n\nfunction updateAllHerosXP(experiencePoints) {\n    let players = game.actors.filter((t) => t.data.type === \"character\");\n    players.map(async player => {\n        let currentName = player.data.name;\n        if (currentName.substring(0, 2) != \"z_\" && !excludeNames.includes(currentName)) {\n            let currentExperiencePoints = parseInt(player.data.data.details.xp.value);\n            let total = currentExperiencePoints + parseInt(experiencePoints);\n            await player.update({ ['data.details.xp.value']: total });\n            expMessage(player, experiencePoints);\n        }\n    });\n}\n\nfunction checkHeroExp() {\n    let heros = [];\n    let characters = game.actors.filter((t) => t.data.type === \"character\");\n    characters.forEach((c) => {\n        let currentName = c.data.name;\n        if (currentName.substring(0, 2) != \"z_\" && !excludeNames.includes(currentName)) {\n            heros.push([c.data.name, c.data.data.details.xp.value, c.data.data.details.level.value]);\n        }\n    });\n    return heros;\n}\n\nfunction expMessage(player, points) {\n    let message = `<h2>${player.data.name}</h2>`;\n    message += `<p>received <b>${points}</b> of experience and now has ${player.data.data.details.xp.value}.</p>`;\n    if (parseInt(player.data.data.details.xp.value) >= 1000) {\n        message += '<p><b style=\"color:red\">Level Available!</b></p>';\n    }\n    let chatData = {\n        user: game.user._id,\n        speaker: ChatMessage.getSpeaker(),\n        content: message\n    };\n    ChatMessage.create(chatData, {});\n}","folder":null,"sort":0,"permission":{"default":0,"u0QnuKi1BChalBsY":3},"flags":{"combat-utility-belt":{"macroTrigger":""},"furnace":{"runAsGM":false},"advanced-macros":{"runAsGM":false},"core":{"sourceId":"Macro.De4ZUqCT0tAqq76E"},"scene-packer":{"sourceId":"Macro.De4ZUqCT0tAqq76E"}},"_id":"yIQRwuPfgkiDQEMC"}
